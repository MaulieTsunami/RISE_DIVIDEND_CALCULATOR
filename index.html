<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RISE by Design Dividend Calculator</title>
  <style>
    body { margin:0; font-family:Arial, sans-serif; background:#0f1220; color:#e8ecff; }
    .container { max-width:900px; margin:20px auto; padding:20px; background:#171a2e; border-radius:12px; }
    h1 { color:#ffb347; }
    label { display:block; margin-top:10px; font-size:14px; }
    input { width:100%; padding:8px; margin-top:4px; border-radius:6px; border:1px solid #333; background:#121426; color:#fff; }
    button { margin-top:12px; padding:10px 14px; border:none; border-radius:6px; background:#ffb347; color:#000; font-weight:bold; cursor:pointer; }
    button.secondary { background:#2a2e49; color:#fff; }
    table { width:100%; margin-top:20px; border-collapse:collapse; }
    th, td { border-bottom:1px solid #333; padding:8px; text-align:right; }
    th:first-child, td:first-child { text-align:left; }
    .summary { margin-top:20px; display:flex; gap:20px; }
    .summary div { flex:1; background:#121426; padding:12px; border-radius:8px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>RISE by Design Dividend Calculator</h1>

    <!-- Ticker input -->
    <label>Stock Ticker</label>
    <input type="text" id="ticker" placeholder="AAPL" />
    <button id="loadTicker" class="secondary">Load Data</button>

    <!-- Inputs -->
    <label>Initial Investment ($)</label>
    <input type="number" id="initial" value="10000" />

    <label>Monthly Contribution ($)</label>
    <input type="number" id="monthly" value="500" />

    <label>Share Price ($)</label>
    <input type="number" id="sharePrice" value="50" />

    <label>Dividend Yield (%)</label>
    <input type="number" id="divYieldPct" value="4" />

    <label>Dividend Growth (%)</label>
    <input type="number" id="divGrowthPct" value="5" />

    <label>Price Growth (%)</label>
    <input type="number" id="priceGrowthPct" value="6" />

    <label>Tax Rate on Dividends (%)</label>
    <input type="number" id="taxRatePct" value="15" />

    <label>Years to Project</label>
    <input type="number" id="years" value="20" />

    <div>
      <input type="checkbox" id="drip" checked />
      <label for="drip">Enable DRIP (Reinvest Dividends)</label>
    </div>

    <button id="calcBtn">Calculate</button>
    <button id="resetBtn" class="secondary">Reset</button>
    <button id="exportBtn" class="secondary">Export CSV</button>

    <!-- Summary -->
    <div class="summary" id="summary"></div>

    <!-- Table -->
    <table id="table">
      <thead>
        <tr>
          <th>Year</th>
          <th>Shares</th>
          <th>Share Price</th>
          <th>Dividends Net</th>
          <th>Contributions</th>
          <th>End Balance</th>
          <th>Yield on Cost</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const el = id => document.getElementById(id);
    const num = v => Number(v) || 0;
    const fmt = v => v.toLocaleString(undefined,{style:'currency',currency:'USD',maximumFractionDigits:0});
    const fmt2 = v => v.toLocaleString(undefined,{style:'currency',currency:'USD',maximumFractionDigits:2});

    // --- Alpha Vantage integration ---
    async function loadTickerData() {
      const ticker = el('ticker').value.trim().toUpperCase();
      if (!ticker) { alert("Enter a ticker symbol."); return; }

      const apiKey = "YOUR_API_KEY_HERE"; // replace with your Alpha Vantage key

      try {
        // Company overview (dividend yield)
        const overviewUrl = `https://www.alphavantage.co/query?function=OVERVIEW&symbol=${ticker}&apikey=${apiKey}`;
        const overviewRes = await fetch(overviewUrl);
        const overviewData = await overviewRes.json();

        // Latest price
        const priceUrl = `https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${ticker}&apikey=${apiKey}`;
        const priceRes = await fetch(priceUrl);
        const priceData = await priceRes.json();
        const timeSeries = priceData["Time Series (Daily)"];
        const latestDate = Object.keys(timeSeries)[0];
        const latestClose = parseFloat(timeSeries[latestDate]["4. close"]);

        el('sharePrice').value = latestClose.toFixed(2);
        if (overviewData.DividendYield) {
          el('divYieldPct').value = (parseFloat(overviewData.DividendYield) * 100).toFixed(2);
        } else {
          alert("No dividend yield data found for this ticker.");
        }
      } catch (err) {
        console.error(err);
        alert("Error fetching data. Check API key or ticker.");
      }
    }
    el('loadTicker').addEventListener('click', loadTickerData);

    // --- Calculator logic ---
    function project(inputs){
      let {initial,monthly,sharePrice,divYieldPct,divGrowthPct,priceGrowthPct,taxRatePct,years,drip}=inputs;
      let shares=initial/sharePrice, price=sharePrice;
      let divYield=divYieldPct/100, divGrowth=divGrowthPct/100, priceGrowth=priceGrowthPct/100, tax=taxRatePct/100;
      let rows=[], cumDiv=0, cumContrib=0;
      for(let y=1;y<=years;y++){
        let divGross=shares*price*divYield, divNet=divGross*(1-tax);
        if(drip) shares+=divNet/price;
        shares+= (monthly*12)/price;
        price*=(1+priceGrowth);
        cumDiv+=divNet; cumContrib+=monthly*12;
        let endBalance=shares*price;
        let yieldOnCost=(cumDiv/(initial+cumContrib))*100;
        rows.push({year:y,shares:shares.toFixed(2),price:price.toFixed(2),divNet:divNet.toFixed(2),contrib:cumContrib.toFixed(2),endBalance:endBalance.toFixed(2),yoc:yieldOnCost.toFixed(1)});
        divYield*=(1+divGrowth);
      }
      return {rows,initial};
    }

    function render(res){
      const tbody=el('table').querySelector('tbody'); tbody.innerHTML='';
      res.rows.forEach(r=>{
        tbody.innerHTML+=`
          <tr>
            <td>${r.year}</td>
            <td>${r.shares}</td>
            <td>${fmt2(r.price)}</td>
            <td>${fmt2(r.divNet)}</td>
            <td>${fmt2(r.contrib)}</td>
            <td>${fmt2(r.endBalance)}</td>
            <td>${r.yoc}%</td>
          </tr>`;
      });
      const last=res.rows[res.rows.length-1];
      el('summary').innerHTML=`
        <div><strong>Final Value</strong><br>${fmt(last.endBalance)}</div>
        <div><strong>Total Contributions</strong><br>${fmt(last.contrib)}</div>
        <div><strong>Total Net Dividends</strong><br>${fmt(res.rows.reduce((a,b)=>a+parseFloat(b.divNet),0))}</div>
        <div><strong>Yield on Cost</strong><br>${last.yoc}%</div>`;
    }

    function calculateAndRender(){
      const inputs={
        initial:num(el('initial').value),
        monthly:num(el('monthly').value),
        sharePrice:num(el('sharePrice').value),
        divYieldPct:num(el('divYieldPct').value),
        divGrowthPct:num(el('divGrowthPct').value),
        priceGrowthPct:num(el('priceGrowthPct').value),
        taxRatePct:num(el('taxRatePct').value),
        years
